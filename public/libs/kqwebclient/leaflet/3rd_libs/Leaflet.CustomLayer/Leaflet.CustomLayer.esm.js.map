{"version":3,"file":"Leaflet.CustomLayer.esm.js","sources":["../src/Leaflet.CustomLayer.js"],"sourcesContent":["import L from \"leaflet\";\n\n/**\n * @class CustomLayer\n * @inherits Layer\n *\n * Leaflet overlay plugin: L.CustomLayer - fully custom Layer.\n */\nconst CustomLayer = L.Layer.extend({\n  // CustomLayer options\n  options: {\n    // How much to extend the clip area around the map view (relative to its size)\n    // e.g. 0.1 would be 10% of map view in each direction\n    padding: 0,\n\n    // How much to extend click tolerance round a path/object on the map\n    tolerance: 0,\n\n    // The DomElement object to display\n    container: null,\n\n    // The opacity of the layer, [0,1]\n    opacity: 1,\n\n    // Is the layer visible\n    visible: true,\n\n    // The zIndex of the layer\n    zIndex: undefined,\n\n    // Set the visibility min zoom level\n    minZoom: 0,\n\n    // Set the visibility max zoom level\n    maxZoom: 18\n\n    // Whether to redraw during zoom panning, complex drawing suggestions are set to false (next version)\n    // alwaysRender: true\n  },\n\n  initialize(options) {\n    L.setOptions(this, options);\n\n    /* Built-in Date */\n    L.stamp(this);\n    this._map = undefined;\n    this._container = undefined;\n    this._bounds = undefined;\n    this._center = undefined;\n    this._zoom = undefined;\n    this._padding = undefined;\n  },\n\n  /* Built-in Lifecycle */\n\n  beforeAdd() {\n    this._zoomVisible = true;\n  },\n\n  getEvents() {\n    // Layer trigger priority\n    // move: movestart -> move -> moveend\n    // zoom: zoomstart -> movestart -> zoomanim -> zoom -> move -> zoomend -> moveend\n    // resize: move -> resize -> moveend\n    let events = {\n      viewreset: this._onLayerViewReset,\n      zoom: this._onLayerZoom,\n      moveend: this._onLayerMoveEnd,\n      zoomend: this._onLayerZoomEnd\n    };\n    if (this._zoomAnimated) {\n      events.zoomanim = this._onLayerAnimZoom;\n    }\n    return events;\n  },\n\n  onAdd() {\n    this.fire(\"layer-beforemount\"); // Lifecycle beforeMount\n\n    if (!this._container) {\n      this._initContainer(); // defined by renderer implementations\n    }\n\n    this.setOpacity(this.options.opacity);\n\n    if (window.isNaN(this.options.zIndex)) {\n      switch (this._container.tagName) {\n        // http://www.w3.org/1999/xhtml\n        case \"CANVAS\": {\n          this.setZIndex(100);\n          break;\n        }\n        // http://www.w3.org/2000/svg\n        case \"svg\": {\n          this.setZIndex(200);\n          break;\n        }\n        default: {\n          this.setZIndex(100);\n        }\n      }\n    } else {\n      this.setZIndex(this.options.zIndex);\n    }\n\n    this.getPane().appendChild(this._container);\n\n    this._onZoomVisible();\n\n    this.fire(\"layer-mounted\"); // Lifecycle mounted\n\n    this._update();\n  },\n\n  onRemove() {\n    this.fire(\"layer-beforedestroy\"); // Lifecycle beforeDestroy\n\n    this._destroyContainer();\n\n    this.fire(\"layer-destroyed\"); // Lifecycle destroyed\n  },\n\n  /* Built-in Events */\n\n  _onLayerViewReset() {\n    this._reset();\n  },\n\n  _onLayerAnimZoom(ev) {\n    this._updateTransform(ev.center, ev.zoom);\n  },\n\n  _onLayerZoom() {\n    this._updateTransform(this._map.getCenter(), this._map.getZoom());\n  },\n\n  _onLayerZoomEnd() {},\n\n  _onLayerMoveEnd() {\n    if (!this._isZoomVisible()) {\n      this._zoomHide();\n      return;\n    }\n\n    this._update();\n  },\n\n  _onZoomVisible() {\n    if (this._isZoomVisible()) {\n      this._zoomShow();\n    } else {\n      this._zoomHide();\n    }\n  },\n\n  /* Built-in Methods */\n\n  _initContainer() {\n    const container = (this._container = this.options.container);\n\n    L.DomUtil.addClass(container, \"leaflet-layer\");\n\n    if (this._zoomAnimated) {\n      L.DomUtil.addClass(this._container, \"leaflet-zoom-animated\");\n    }\n  },\n\n  _destroyContainer() {\n    L.DomUtil.remove(this._container);\n    delete this._container;\n  },\n\n  _isZoomVisible() {\n    const minZoom = this.options.minZoom;\n    const maxZoom = this.options.maxZoom;\n    const zoom = this._map.getZoom();\n\n    const isVisible = zoom >= minZoom && zoom <= maxZoom;\n\n    return isVisible;\n  },\n\n  _zoomShow() {\n    if (this._zoomVisible) return;\n    this._zoomVisible = true;\n\n    this._map.off({ zoomend: this._onZoomVisible }, this);\n\n    if (!this.options.visible) return;\n    this._map.on(this.getEvents(), this);\n\n    this.getContainer().style.display = \"\";\n\n    // Subsequent moveend events take the place of update\n    // this._update();\n  },\n\n  _zoomHide() {\n    if (!this._zoomVisible) return;\n    this._zoomVisible = false;\n\n    this._map.off(this.getEvents(), this);\n    this._map.on({ zoomend: this._onZoomVisible }, this);\n\n    this.getContainer().style.display = \"none\";\n  },\n\n  _updateTransform(center, zoom) {\n    const scale = this._map.getZoomScale(zoom, this._zoom);\n    const position = L.DomUtil.getPosition(this._container);\n    const viewHalf = this._map.getSize().multiplyBy(0.5 + this.options.padding);\n    const currentCenterPoint = this._map.project(this._center, zoom);\n    const destCenterPoint = this._map.project(center, zoom);\n    const centerOffset = destCenterPoint.subtract(currentCenterPoint);\n    const topLeftOffset = viewHalf\n      .multiplyBy(-scale)\n      .add(position)\n      .add(viewHalf)\n      .subtract(centerOffset);\n\n    if (L.Browser.any3d) {\n      L.DomUtil.setTransform(this._container, topLeftOffset, scale);\n    } else {\n      L.DomUtil.setPosition(this._container, topLeftOffset);\n    }\n  },\n\n  _update() {\n    if (this._map._animatingZoom && this._bounds) {\n      return;\n    }\n\n    this.__update();\n\n    let b = this._bounds;\n    let container = this._container;\n\n    L.DomUtil.setPosition(container, b.min);\n\n    this.fire(\"layer-render\"); // Lifecycle render\n  },\n  __update() {\n    // Update pixel bounds of renderer container (for positioning/sizing/clipping later)\n    // Subclasses are responsible of firing the 'update' event.\n    const p = this.options.padding;\n    const size = this._map.getSize();\n    const min = this._map.containerPointToLayerPoint(size.multiplyBy(-p));\n\n    this._padding = size.multiplyBy(p);\n\n    // this._bounds = new L.Bounds(\n    //   min.round(),\n    //   min.add(size.multiplyBy(1 + p * 2)).round()\n    // );\n    this._bounds = new L.Bounds(min, min.add(size.multiplyBy(1 + p * 2)));\n\n    this._center = this._map.getCenter();\n    this._zoom = this._map.getZoom();\n  },\n\n  _reset() {\n    this._update();\n    this._updateTransform(this._center, this._zoom);\n  },\n\n  /**\n   * API\n   */\n\n  /* Methods */\n\n  getContainer() {\n    return this._container;\n  },\n\n  setContainer(newContainer) {\n    const old = this.getContainer();\n    const parent = old.parentNode;\n\n    delete this._container;\n    this.options.container = newContainer;\n\n    if (!this._container) {\n      this._initContainer();\n    }\n\n    this.setOpacity(this.options.opacity);\n\n    if (window.isNaN(this.options.zIndex)) {\n      switch (this._container.tagName) {\n        case \"CANVAS\": {\n          this.setZIndex(100);\n          break;\n        }\n        case \"svg\": {\n          this.setZIndex(200);\n          break;\n        }\n        default: {\n          this.setZIndex(100);\n        }\n      }\n    } else {\n      this.setZIndex(this.options.zIndex);\n    }\n\n    if (parent) {\n      parent.replaceChild(newContainer, old);\n    } else {\n      this.getPane().appendChild(newContainer);\n    }\n\n    this._update();\n\n    return this;\n  },\n\n  getOpacity() {\n    return this.options.opacity;\n  },\n\n  setOpacity(opacity) {\n    this.getContainer().style.opacity = this.options.opacity = opacity * 1;\n    return this;\n  },\n\n  getZIndex() {\n    return this.options.zIndex;\n  },\n\n  setZIndex(zIndex) {\n    this.getContainer().style.zIndex = this.options.zIndex = zIndex * 1;\n    return this;\n  },\n\n  show() {\n    if (this.options.visible) return;\n    this.options.visible = true;\n\n    if (!this._isZoomVisible()) {\n      this._zoomHide();\n      return;\n    }\n\n    this._map.on(this.getEvents(), this);\n    this.getContainer().style.display = \"\";\n    this._update();\n\n    return this;\n  },\n\n  hide() {\n    if (!this.options.visible) return;\n    this.options.visible = false;\n\n    this._zoomHide();\n\n    this._map.off(this.getEvents(), this);\n    this.getContainer().style.display = \"none\";\n\n    return this;\n  },\n\n  setFullLayerBounds() {\n    const container = this.getContainer();\n    const size = this._bounds.getSize();\n    const padding = this._padding;\n\n    switch (container.tagName) {\n      case \"CANVAS\": {\n        const dpr = L.Browser.retina ? 2 : 1;\n        container.width = dpr * size.x;\n        container.height = dpr * size.y;\n        container.style.width = size.x + \"px\";\n        container.style.height = size.y + \"px\";\n\n        const ctx = container.getContext(\"2d\");\n        if (L.Browser.retina) ctx.scale(dpr, dpr);\n        ctx.translate(padding.x, padding.y);\n\n        return { container, ctx, dpr };\n      }\n      case \"svg\": {\n        container.setAttribute(\"width\", size.x);\n        container.setAttribute(\"height\", size.y);\n        container.style.width = size.x + \"px\";\n        container.style.height = size.y + \"px\";\n        container.setAttribute(\n          \"viewBox\",\n          `${-padding.x} ${-padding.y} ${size.x} ${size.y}`\n        );\n\n        return { container };\n      }\n      case \"DIV\": {\n        container.style.boxSizing = \"content-box\";\n        container.style.width = size.x - padding.x + \"px\";\n        container.style.height = size.y - padding.y + \"px\";\n        container.style.padding = `${padding.y}px ${padding.x}px`;\n\n        return { container };\n      }\n      default: {\n        container.setAttribute(\"width\", size.x);\n        container.setAttribute(\"height\", size.y);\n        container.style.width = size.x + \"px\";\n        container.style.height = size.y + \"px\";\n        return { container };\n      }\n    }\n  }\n\n  /* Events */\n  // on(\"layer-beforemount\", fn);\n  // on(\"layer-mounted\", fn);\n  // on(\"layer-render\", fn);\n  // on(\"layer-beforedestroy\", fn);\n  // on(\"layer-destroyed\", fn);\n});\n\n// @factory L.customLayer(options?: Renderer options)\n// Creates a CustomLayer renderer with the given options.\nfunction customLayer(options) {\n  return L.customLayer ? new CustomLayer(options) : null;\n}\n\n/**\n * Plugin Props\n */\n\nL.CustomLayer = CustomLayer;\nL.customLayer = customLayer;\n\n/**\n * Exports\n */\n\nexport { CustomLayer };\nexport { customLayer };\nexport default customLayer;\n"],"names":["CustomLayer","L","Layer","extend","options","padding","tolerance","container","opacity","visible","zIndex","undefined","minZoom","maxZoom","initialize","setOptions","this","stamp","_map","_container","_bounds","_center","_zoom","_padding","beforeAdd","_zoomVisible","getEvents","events","viewreset","_onLayerViewReset","zoom","_onLayerZoom","moveend","_onLayerMoveEnd","zoomend","_onLayerZoomEnd","_zoomAnimated","zoomanim","_onLayerAnimZoom","onAdd","fire","_initContainer","setOpacity","window","isNaN","tagName","setZIndex","getPane","appendChild","_onZoomVisible","_update","onRemove","_destroyContainer","_reset","ev","_updateTransform","center","getCenter","getZoom","_isZoomVisible","_zoomHide","_zoomShow","DomUtil","addClass","remove","off","on","getContainer","style","display","scale","getZoomScale","position","getPosition","viewHalf","getSize","multiplyBy","currentCenterPoint","project","centerOffset","subtract","topLeftOffset","add","Browser","any3d","setTransform","setPosition","_animatingZoom","__update","b","min","p","size","containerPointToLayerPoint","Bounds","setContainer","newContainer","old","parent","parentNode","replaceChild","getOpacity","getZIndex","show","hide","setFullLayerBounds","dpr","retina","width","x","height","y","ctx","getContext","translate","setAttribute","boxSizing","customLayer"],"mappings":"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"}