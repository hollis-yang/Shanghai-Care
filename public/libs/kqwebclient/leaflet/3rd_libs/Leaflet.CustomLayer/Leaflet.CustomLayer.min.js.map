{"version":3,"file":"Leaflet.CustomLayer.min.js","sources":["../src/Leaflet.CustomLayer.js"],"sourcesContent":["import L from \"leaflet\";\n\n/**\n * @class CustomLayer\n * @inherits Layer\n *\n * Leaflet overlay plugin: L.CustomLayer - fully custom Layer.\n */\nconst CustomLayer = L.Layer.extend({\n  // CustomLayer options\n  options: {\n    // How much to extend the clip area around the map view (relative to its size)\n    // e.g. 0.1 would be 10% of map view in each direction\n    padding: 0,\n\n    // How much to extend click tolerance round a path/object on the map\n    tolerance: 0,\n\n    // The DomElement object to display\n    container: null,\n\n    // The opacity of the layer, [0,1]\n    opacity: 1,\n\n    // Is the layer visible\n    visible: true,\n\n    // The zIndex of the layer\n    zIndex: undefined,\n\n    // Set the visibility min zoom level\n    minZoom: 0,\n\n    // Set the visibility max zoom level\n    maxZoom: 18\n\n    // Whether to redraw during zoom panning, complex drawing suggestions are set to false (next version)\n    // alwaysRender: true\n  },\n\n  initialize(options) {\n    L.setOptions(this, options);\n\n    /* Built-in Date */\n    L.stamp(this);\n    this._map = undefined;\n    this._container = undefined;\n    this._bounds = undefined;\n    this._center = undefined;\n    this._zoom = undefined;\n    this._padding = undefined;\n  },\n\n  /* Built-in Lifecycle */\n\n  beforeAdd() {\n    this._zoomVisible = true;\n  },\n\n  getEvents() {\n    // Layer trigger priority\n    // move: movestart -> move -> moveend\n    // zoom: zoomstart -> movestart -> zoomanim -> zoom -> move -> zoomend -> moveend\n    // resize: move -> resize -> moveend\n    let events = {\n      viewreset: this._onLayerViewReset,\n      zoom: this._onLayerZoom,\n      moveend: this._onLayerMoveEnd,\n      zoomend: this._onLayerZoomEnd\n    };\n    if (this._zoomAnimated) {\n      events.zoomanim = this._onLayerAnimZoom;\n    }\n    return events;\n  },\n\n  onAdd() {\n    this.fire(\"layer-beforemount\"); // Lifecycle beforeMount\n\n    if (!this._container) {\n      this._initContainer(); // defined by renderer implementations\n    }\n\n    this.setOpacity(this.options.opacity);\n\n    if (window.isNaN(this.options.zIndex)) {\n      switch (this._container.tagName) {\n        // http://www.w3.org/1999/xhtml\n        case \"CANVAS\": {\n          this.setZIndex(100);\n          break;\n        }\n        // http://www.w3.org/2000/svg\n        case \"svg\": {\n          this.setZIndex(200);\n          break;\n        }\n        default: {\n          this.setZIndex(100);\n        }\n      }\n    } else {\n      this.setZIndex(this.options.zIndex);\n    }\n\n    this.getPane().appendChild(this._container);\n\n    this._onZoomVisible();\n\n    this.fire(\"layer-mounted\"); // Lifecycle mounted\n\n    this._update();\n  },\n\n  onRemove() {\n    this.fire(\"layer-beforedestroy\"); // Lifecycle beforeDestroy\n\n    this._destroyContainer();\n\n    this.fire(\"layer-destroyed\"); // Lifecycle destroyed\n  },\n\n  /* Built-in Events */\n\n  _onLayerViewReset() {\n    this._reset();\n  },\n\n  _onLayerAnimZoom(ev) {\n    this._updateTransform(ev.center, ev.zoom);\n  },\n\n  _onLayerZoom() {\n    this._updateTransform(this._map.getCenter(), this._map.getZoom());\n  },\n\n  _onLayerZoomEnd() {},\n\n  _onLayerMoveEnd() {\n    if (!this._isZoomVisible()) {\n      this._zoomHide();\n      return;\n    }\n\n    this._update();\n  },\n\n  _onZoomVisible() {\n    if (this._isZoomVisible()) {\n      this._zoomShow();\n    } else {\n      this._zoomHide();\n    }\n  },\n\n  /* Built-in Methods */\n\n  _initContainer() {\n    const container = (this._container = this.options.container);\n\n    L.DomUtil.addClass(container, \"leaflet-layer\");\n\n    if (this._zoomAnimated) {\n      L.DomUtil.addClass(this._container, \"leaflet-zoom-animated\");\n    }\n  },\n\n  _destroyContainer() {\n    L.DomUtil.remove(this._container);\n    delete this._container;\n  },\n\n  _isZoomVisible() {\n    const minZoom = this.options.minZoom;\n    const maxZoom = this.options.maxZoom;\n    const zoom = this._map.getZoom();\n\n    const isVisible = zoom >= minZoom && zoom <= maxZoom;\n\n    return isVisible;\n  },\n\n  _zoomShow() {\n    if (this._zoomVisible) return;\n    this._zoomVisible = true;\n\n    this._map.off({ zoomend: this._onZoomVisible }, this);\n\n    if (!this.options.visible) return;\n    this._map.on(this.getEvents(), this);\n\n    this.getContainer().style.display = \"\";\n\n    // Subsequent moveend events take the place of update\n    // this._update();\n  },\n\n  _zoomHide() {\n    if (!this._zoomVisible) return;\n    this._zoomVisible = false;\n\n    this._map.off(this.getEvents(), this);\n    this._map.on({ zoomend: this._onZoomVisible }, this);\n\n    this.getContainer().style.display = \"none\";\n  },\n\n  _updateTransform(center, zoom) {\n    const scale = this._map.getZoomScale(zoom, this._zoom);\n    const position = L.DomUtil.getPosition(this._container);\n    const viewHalf = this._map.getSize().multiplyBy(0.5 + this.options.padding);\n    const currentCenterPoint = this._map.project(this._center, zoom);\n    const destCenterPoint = this._map.project(center, zoom);\n    const centerOffset = destCenterPoint.subtract(currentCenterPoint);\n    const topLeftOffset = viewHalf\n      .multiplyBy(-scale)\n      .add(position)\n      .add(viewHalf)\n      .subtract(centerOffset);\n\n    if (L.Browser.any3d) {\n      L.DomUtil.setTransform(this._container, topLeftOffset, scale);\n    } else {\n      L.DomUtil.setPosition(this._container, topLeftOffset);\n    }\n  },\n\n  _update() {\n    if (this._map._animatingZoom && this._bounds) {\n      return;\n    }\n\n    this.__update();\n\n    let b = this._bounds;\n    let container = this._container;\n\n    L.DomUtil.setPosition(container, b.min);\n\n    this.fire(\"layer-render\"); // Lifecycle render\n  },\n  __update() {\n    // Update pixel bounds of renderer container (for positioning/sizing/clipping later)\n    // Subclasses are responsible of firing the 'update' event.\n    const p = this.options.padding;\n    const size = this._map.getSize();\n    const min = this._map.containerPointToLayerPoint(size.multiplyBy(-p));\n\n    this._padding = size.multiplyBy(p);\n\n    // this._bounds = new L.Bounds(\n    //   min.round(),\n    //   min.add(size.multiplyBy(1 + p * 2)).round()\n    // );\n    this._bounds = new L.Bounds(min, min.add(size.multiplyBy(1 + p * 2)));\n\n    this._center = this._map.getCenter();\n    this._zoom = this._map.getZoom();\n  },\n\n  _reset() {\n    this._update();\n    this._updateTransform(this._center, this._zoom);\n  },\n\n  /**\n   * API\n   */\n\n  /* Methods */\n\n  getContainer() {\n    return this._container;\n  },\n\n  setContainer(newContainer) {\n    const old = this.getContainer();\n    const parent = old.parentNode;\n\n    delete this._container;\n    this.options.container = newContainer;\n\n    if (!this._container) {\n      this._initContainer();\n    }\n\n    this.setOpacity(this.options.opacity);\n\n    if (window.isNaN(this.options.zIndex)) {\n      switch (this._container.tagName) {\n        case \"CANVAS\": {\n          this.setZIndex(100);\n          break;\n        }\n        case \"svg\": {\n          this.setZIndex(200);\n          break;\n        }\n        default: {\n          this.setZIndex(100);\n        }\n      }\n    } else {\n      this.setZIndex(this.options.zIndex);\n    }\n\n    if (parent) {\n      parent.replaceChild(newContainer, old);\n    } else {\n      this.getPane().appendChild(newContainer);\n    }\n\n    this._update();\n\n    return this;\n  },\n\n  getOpacity() {\n    return this.options.opacity;\n  },\n\n  setOpacity(opacity) {\n    this.getContainer().style.opacity = this.options.opacity = opacity * 1;\n    return this;\n  },\n\n  getZIndex() {\n    return this.options.zIndex;\n  },\n\n  setZIndex(zIndex) {\n    this.getContainer().style.zIndex = this.options.zIndex = zIndex * 1;\n    return this;\n  },\n\n  show() {\n    if (this.options.visible) return;\n    this.options.visible = true;\n\n    if (!this._isZoomVisible()) {\n      this._zoomHide();\n      return;\n    }\n\n    this._map.on(this.getEvents(), this);\n    this.getContainer().style.display = \"\";\n    this._update();\n\n    return this;\n  },\n\n  hide() {\n    if (!this.options.visible) return;\n    this.options.visible = false;\n\n    this._zoomHide();\n\n    this._map.off(this.getEvents(), this);\n    this.getContainer().style.display = \"none\";\n\n    return this;\n  },\n\n  setFullLayerBounds() {\n    const container = this.getContainer();\n    const size = this._bounds.getSize();\n    const padding = this._padding;\n\n    switch (container.tagName) {\n      case \"CANVAS\": {\n        const dpr = L.Browser.retina ? 2 : 1;\n        container.width = dpr * size.x;\n        container.height = dpr * size.y;\n        container.style.width = size.x + \"px\";\n        container.style.height = size.y + \"px\";\n\n        const ctx = container.getContext(\"2d\");\n        if (L.Browser.retina) ctx.scale(dpr, dpr);\n        ctx.translate(padding.x, padding.y);\n\n        return { container, ctx, dpr };\n      }\n      case \"svg\": {\n        container.setAttribute(\"width\", size.x);\n        container.setAttribute(\"height\", size.y);\n        container.style.width = size.x + \"px\";\n        container.style.height = size.y + \"px\";\n        container.setAttribute(\n          \"viewBox\",\n          `${-padding.x} ${-padding.y} ${size.x} ${size.y}`\n        );\n\n        return { container };\n      }\n      case \"DIV\": {\n        container.style.boxSizing = \"content-box\";\n        container.style.width = size.x - padding.x + \"px\";\n        container.style.height = size.y - padding.y + \"px\";\n        container.style.padding = `${padding.y}px ${padding.x}px`;\n\n        return { container };\n      }\n      default: {\n        container.setAttribute(\"width\", size.x);\n        container.setAttribute(\"height\", size.y);\n        container.style.width = size.x + \"px\";\n        container.style.height = size.y + \"px\";\n        return { container };\n      }\n    }\n  }\n\n  /* Events */\n  // on(\"layer-beforemount\", fn);\n  // on(\"layer-mounted\", fn);\n  // on(\"layer-render\", fn);\n  // on(\"layer-beforedestroy\", fn);\n  // on(\"layer-destroyed\", fn);\n});\n\n// @factory L.customLayer(options?: Renderer options)\n// Creates a CustomLayer renderer with the given options.\nfunction customLayer(options) {\n  return L.customLayer ? new CustomLayer(options) : null;\n}\n\n/**\n * Plugin Props\n */\n\nL.CustomLayer = CustomLayer;\nL.customLayer = customLayer;\n\n/**\n * Exports\n */\n\nexport { CustomLayer };\nexport { customLayer };\nexport default customLayer;\n"],"names":["CustomLayer","Layer","extend","options","padding","tolerance","container","opacity","visible","zIndex","undefined","minZoom","maxZoom","initialize","L","setOptions","this","stamp","_map","_container","_bounds","_center","_zoom","_padding","beforeAdd","_zoomVisible","getEvents","events","viewreset","_onLayerViewReset","zoom","_onLayerZoom","moveend","_onLayerMoveEnd","zoomend","_onLayerZoomEnd","_zoomAnimated","zoomanim","_onLayerAnimZoom","onAdd","fire","_initContainer","setOpacity","window","isNaN","tagName","setZIndex","getPane","appendChild","_onZoomVisible","_update","onRemove","_destroyContainer","_reset","ev","_updateTransform","center","getCenter","getZoom","_isZoomVisible","_zoomHide","_zoomShow","DomUtil","addClass","remove","off","on","getContainer","style","display","scale","getZoomScale","position","getPosition","viewHalf","getSize","multiplyBy","currentCenterPoint","project","centerOffset","subtract","topLeftOffset","add","Browser","any3d","setTransform","setPosition","_animatingZoom","__update","b","min","p","size","containerPointToLayerPoint","Bounds","setContainer","newContainer","old","parent","parentNode","replaceChild","getOpacity","getZIndex","show","hide","setFullLayerBounds","dpr","retina","width","x","height","y","ctx","getContext","translate","setAttribute","boxSizing","customLayer"],"mappings":"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"}